<!DOCTYPE html>
<html lang="en">
<style>
    .buttonpltw
    {

    background-color: #ffffff;
    color: black;
    text-align: center;
    font-size: 16px;
    padding: 4px 4px;

    font-family: calibri;
    border-radius: 8px;
        
    }
    .button
    {
    background-color: #ffffff;
    color: black;
    padding: 1px 1px;
    text-align: center;
    font-size: 16px;
    font-family: calibri;
    border-radius: 8px;
    width: 400px;
    
    }
    
    .text
    {

    font-family: calibri; 
    font-size: 18px; 
    color: white;
    text-align: center;
    }
    .smalltext
    {

    font-family: calibri; 
    font-size: 18px; 
    color: white;
    text-align: center;
    }
    .medtext
    {

    font-family: calibri; 
    font-size: 25px; 
    color: white;
    text-align: center;
    }
    .bigtext
    {

    font-family: calibri; 
    font-size: 85px; 
    color: white;
    text-align: center;
    }
    .nums
    {

    font-family: calibri; 
    font-size: 40px; 
    color: white;
    text-align: center;

    }
</style>

<body id = "back" style = "background-color:slategrey;" >

        <head><title>GPA Calculator</title></head>
    <br>
    <div>
        <p class = "bigtext"> <b>Weighted GPA Calculator</b> </p>
    </div>


    <div style = "text-align: center;">
        <!-- <div style = "text-align: center;display: none;">
        <button onclick ="toggle()" id="dir" class = "button">Show me what to copy</button>
        </div> -->


        <div>
            <p class = "medtext"  id = "pupilpath">  Copy the entire PupilPath chart and paste it in the box below </p>
            <input class = "button" autocomplete = "off" id = "direct" type="text" oninput= "quick()"> 

                <br><br>
                <div  id = "faq" style = "display:block;">
                    <center><img  src = "demo.gif" > </center>
                </div>

                <div id = "pl" style = "display:none; text-align: center;" class = "text">
                    <p class = "text" id = "textclick">Click on your PLTW Classes Grades in order to weigh them</p>



                    <div id="adjustpltw"  ></select>

                      <br>



                </div>
            </div>
     </div>



    <br>
    <div  id = "manual" style = "display:block;">
        <p class = "text" id = "textmanual"> <b>You can also manually enter your grades, separated by commas</b></p>
            
        <form>
            <pre class = "text" >Normal Grades            <input class = "button" autocomplete="off" id = "grades" type="text" oninput="avg()"> </pre>
        </form>
        <form> 
            <pre class = "text"> Gym Grade                  <input class = "button" autocomplete="off" id = "gym" type="text" oninput="avg()"> </pre>
        </form>
        <form>
            <pre class = "text"> AP or PLTW Grades    <input class = "button" autocomplete="off" id = "AP" type="text" oninput="avg()"> </pre>
        </form>
        <p id="gradesHere"></p>
    </div>


    <div><br>
        <p class = "text">Some classes, such as AP Physics 1, are weighted double. This is indicated by 2.0 credits instead of 1.0 on your transcript. <br>If you have a double weighted class, just enter the grade twice in it's category. <br></p>

        <p class = "smalltext"> <b><a href = "https://bths.edu/">BTHS</a>. By Andrew Tam, Applied Mathematics, '21. </b> </p>
    </div>

</body>

<script>
    var gymEntered = false;
    function quick()
    {
        var str = document.getElementById("direct").value;
        
        if (str.length > 0)
        {  
            document.getElementById("faq").style.display = "none";
            document.getElementById("pupilpath").style.display = "none";
            document.getElementById("pl").style.display = "block";

            var gradeArray  =[];
            var grade, start;
            var start;

            for (var i = 0; i < str.length; i++)
                if (str.substring(i, i + 1) === ":")
                    if (str.substring(i, i + 5).indexOf(" - ") < 0 && determineWeight(str, start, i) != "none")
                    {
                        gradeArray.push(new Grade(findNums(str, i), determineWeight(str, start, i)))
                        start = i + (gradeArray[gradeArray.length-1].getAvg() +"").length
                        i = start
                    }
                    else
                    {
                        i += 6;
                        start = i;
                    } 

            var normal = "";
            var gym = "";
            var ap = "";
            var potentialpltw = ""
            var count = 0;

            for (var i = 0; i < gradeArray.length; i++)
                if (gradeArray[i].getType() == "ap") 
                    ap += gradeArray[i].getAvg() + ", "
                else if (gradeArray[i].getType() == "gym") 
                    gym += gradeArray[i].getAvg()
                else
                {
                    normal += gradeArray[i].getAvg() + ", "
                    potentialpltw += `<button id =  ${gradeArray[i].getAvg()} class = "buttonpltw" onclick="adjustap(${gradeArray[i].getAvg()})"> ${gradeArray[i].getAvg()}</button>`
                    count++;
                }

             if (normal.substring(normal.length - 2, normal.length) == ", ")   
                normal = normal.substring(0, normal.length - 2)
             if (ap.substring(ap.length - 2, ap.length) == ", ")   
                ap = ap.substring(0, ap.length - 2)


            if (count === 0)
                document.getElementById("adjustpltw").style.display = "none"
            else
                document.getElementById("adjustpltw").style.display = "inline-block"

            
            document.getElementById("adjustpltw").innerHTML = potentialpltw
            document.getElementById("textmanual").style.display = "none"

            document.getElementById("gym").value = gym
            document.getElementById("AP").value = ap
            document.getElementById("grades").value = normal

            if (document.getElementById("grades").value === "")
                document.getElementById("textclick").style.display = "none"
            avg()
        }
    }

    function avg()
    {   
        var normGrades = strToArr(document.getElementById('grades').value);
        var gym = document.getElementById('gym').value;
        var APGrades = strToArr(document.getElementById('AP').value);
        
        var transcript = []
        var transcriptunweighted =[]

        transcript = transcript.concat(normGrades)
        transcriptunweighted = transcriptunweighted.concat(normGrades)

        for (var i = 0; i < APGrades.length; i++)
        {
            transcriptunweighted = transcriptunweighted.concat(APGrades[i])
                APGrades[i] = APGrades[i] * 1.1
        }

        transcript  = transcript.concat(APGrades)

        if (parseFloat(gym) > 0)
        { 
            transcript =  transcript.concat( parseFloat(gym)/2 )
            transcriptunweighted =  transcriptunweighted.concat( parseFloat(gym)/2 )

            gymEntered = true
        }
        else
            gymEntered = false

        document.getElementById("gradesHere").innerHTML = "<center> <font class = \"nums\"> 100 Scale: " + roundTo2(calcAvg(transcript)) +
        "</font></center> <center> <font class = \"nums\"> 4.0 Scale: " + roundTo2(calcAvg(/*Code by Andrew Tam*/to4point0(transcriptunweighted, APGrades.length)))+ "</font></center>";
    }

    function calcAvg(nums)
    {
        var sm = 0;
        var invalid = 0;

        for (var i = 0; i < nums.length; i++)
        {
            if (nums[i] !== "" && nums[i] !== ",")
                sm += parseFloat(nums[i])
            else
                invalid++ 
        }

        if  (sm == 0)
            return "0"
        if (gymEntered)
            invalid += 0.5;

        sm = sm / (nums.length - invalid)
       
        
        return sm + ""
    }

    function manual()
    {
        var button = document.getElementById("manual");
        if (button.style.display === "none")
        {
            button.style.display = "block";
            document.getElementById("manualbutton").innerHTML = "Hide"
        }
        else
        {
            button.style.display = "none";
            document.getElementById("manualbutton").innerHTML = "Manual Input"
        }
    }

    function strToArr(nums)
    {
        if (nums === "")
            return []
        var numArray = nums.split(",");
        for (var i = numArray.length; i > -1 ; i--)
        {
            numArray[i]= parseFloat(numArray[i])
            if (numArray[i] + "" == "NaN")
            {
                numArray.splice(i, 1)
            }

        }
        return numArray
    }
    function to4point0(arr, numAPs)
    {
      
        if (gymEntered && isNum(arr[arr.length-1]))
            arr[arr.length-1] *= 2
        else if (gymEntered)
            arr[arr.length-2] *= 2

        for(var i = 0; i < arr.length; i++)
            if (arr[i] >= 93)
                arr[i] = 4
            else if (arr[i] >= 90)
                arr[i] = 3.7
            else if (arr[i] >= 87)
                arr[i] = 3.3
            else if (arr[i] >= 83)
                arr[i] = 3
            else if (arr[i] >= 80)
                arr[i] = 2.7
            else if (arr[i] >= 77)
                arr[i] = 2.3
            else if (arr[i] >= 73)
                arr[i] = 2
            else if (arr[i] >= 70)
                arr[i] = 1.7
            else if (arr[i] >= 67)
                arr[i] = 1.3
            else if (arr[i] >= 65)
                arr[i] = 1
            else if (arr[i] >= 0)
                arr[i] = 0
            else;

        if (gymEntered && isNum(arr[arr.length-1]))
            arr[arr.length-1] /= 2
        else if (gymEntered)
            arr[arr.length-2] /= 2

        if (numAPs > 0)
            arr[0] += numAPs

        return arr
    }
    class Grade
    {
        constructor(avg, type)
        {
            if (avg > 100)
                avg = 100
            this.avg = avg
            this.type = type
        }

        getAvg() {return this.avg}
        getType() {return (this.type)}
        setType(str) {this.type = str} 
        setAvg(str) {this.avg = avg}
        calcGrade()
        {
            if (this.type == "gym")
                return this.avg/2
            else if (this.type == "ap")
                return this.avg * 1.1
            return this.avg 
        }

        toString()
        {
            return "Average" + this.avg + " Weight:" + this.type        
        }
    }


    function adjustap(i)
    {          
        var str = document.getElementById("grades").value
        


        var pos = str.indexOf(i+", ")        
        if (pos === -1)
            pos = str.indexOf(", "+ i)     

            document.getElementById("grades").value = str.substring(0, pos) + str.substring(pos + (i + "").length + 2) 

        document.getElementById("AP").value = document.getElementById("AP").value + ", " + i
        document.getElementById(i).style.display = "none"

        if (document.getElementById("grades").value === "")
        {
            document.getElementById("adjustpltw").style.display = "none"
            document.getElementById("textclick").style.display = "none"
        }
        avg()
    }

    function determineWeight(str, start, end)
    {

        if ( str.substring(start, end+1).toUpperCase().indexOf("PHYSICAL EDUCATION") > 0)
            return "gym"
        
        else if ((str.substring(start, end+1).toUpperCase().indexOf("AP ")) >0)
            return "ap"
        if ( str.substring(start, end+1).toUpperCase().indexOf("LAB") > 0)
            return "none"
        if ( str.substring(start, end+1).toUpperCase().indexOf("ADVISORY") > 0)
            return "none"
        return ""
    }

    function findNums(str, start)
    {
        var i = start
        while (i < str.length)
            if (isNum(str.substring(i, i+1)))
                break
            else
                i++
        start = i 
        i++

        while (isNum(str.substring(start,i)) && i < str.length+1)
            i++   
        return parseFloat(str.substring(start, i-1))
    }

    function isNum(str)
    {
        return parseFloat(str) == str
    }
    function roundTo2(num)
    {
        return Math.round(num*100) / 100
    }


</script>
</html>
